<!DOCTYPE html>
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>乐评家</title>
		<link href="../../content/mui/mui.min.css" rel="stylesheet" />
		<link href="../../content/fonts/iconfont.css" rel="stylesheet" />
		<link href="../../content/common/global.css" rel="stylesheet" />
		<link href="../../content/common/style.css" rel="stylesheet" />
		<link href="../../content/mui/mui.picker.min.css" rel="stylesheet" />
		<style>
			.mui-popover {
				height: auto!important;
				padding: 15px 0;
				/*top: 44px!important;*/
			}
			
			#bottomPopover {
				top: 44px!important;
			}
			
			.mui-bar-nav i:first-of-type {
				color: #fff;
				font-size: 1.6rem!important;
				float: left;
				padding-left: 10px;
			}
			
			.mui-bar-nav i:last-of-type {
				color: #fff;
				font-size: 1.02rem;
				float: right;
				margin-right: 0!important;
				text-align: right;
				padding-right: 10px;
			}
			/*.fontadjusting{
				color: greenyellow !important;
			}*/
			
			.btn-open {
				padding: 8px 0;
				margin-top: 8px;
				font-size: 16px!important;
			}
			
			@media screen and (max-height: 489px) {
				.auto-height {
					line-height: 21px;
				}
			}
			
			@media screen and (min-height:490px) and (max-height: 568px) {
				.auto-height {
					line-height: 23px;
				}
			}
			
			@media screen and (min-height:569px) and (max-height: 627px) {
				.auto-height {
					line-height: 31px;
				}
			}			
			@media screen and (min-height:628px) {
				.auto-height {
					line-height: 36px;
				}
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<!--<a class="iconfont a-left" data-bind="event:{tap: gotoCoursesList}, visible: IsTeacher">&#xe641;</a>-->
			<h1 class="mui-title">课程表</h1>
			<a class="iconfont a-right" href="#bottomPopover" data-bind="visible: IsTeacher, style: {color: FilteredCourseID() > 0 ? 'orange' : ''}">&#xe648;
			</a>
		</header>
		<!--右上角弹出开始-->
		<div id="bottomPopover" class="mui-popover popover-height">
			<ul class="mui-table-view" data-bind="foreach:{data: Courses}">
				<li class="mui-table-view-cell navigate-font" data-bind="click: filterCourses">
					<a href="#" data-bind="text: CourseName"></a>
				</li>
			</ul>
		</div>

		<div class="mui-content">
			<table class="vailableTime-title availableTime-add availableTime-date availableTime-padding" border="0" width="100%" height="100%">
				<tr>
					<td rowspan="2" class="month" data-bind='text: TheMonth'>
					</td>
					<!--ko foreach:{data: DayOfWeek}-->
					<td data-bind='text: $data'></td>
					<!--/ko-->
				</tr>
				<tr data-bind="foreach:{data: DateOfWeek, as: 'date'}">
					<td data-bind='text: date.getDate(), css: {"date-current": CurrentDay() == date.getDate() && CurrentMonth() == date.getMonth()}'></td>
				</tr>
			</table>
			<table class="availableTime-table auto-height" border="2" cellspacing="0" cellpadding="0" width="100%" height="100%" data-bind="foreach:{data: Hours, as: 'hour'}">
				<tr>
					<td data-bind='text: $data + ":00"'></td>
					<!--ko foreach:{data: DateOfWeek}-->
					<td data-bind='cellValue: initCell($data, hour)'></td>
					<!--/ko-->
				</tr>
			</table>
			<!--<div class="mui-input-row mui-pull-right">
				<span class="normaltime" style="width: 20px;">&nbsp;</span>正常
				<span class="finishedtime" style="width: 20px;">&nbsp;</span>已完成
				<span class="overtime" style="width: 20px;">&nbsp;</span>超时
				|
				<span class="fontadjusting">调整中</span>
			</div>-->
			<div class="availableTime-table  course-z">
				<em class="normaltime"></em>
				<span class="normaltime-font">正常</span>
				<em class="finishedtime"></em>
				<span class="finishedtime-font">已结束</span>
				<!--<em class="overtime"></em>
				<span class="overtime-font">超时</span>-->
				<span class="fontadjusting-font">调整中</span>
			</div>
			<!--<div class="mui-content-padded">
			  	 <button type="button" class="mui-btn mui-btn-primary mui-btn-block btn-open" data-bind="event:{tap: gotoCoursesList}, visible: IsTeacher">我要开课</button>
			  	</div>-->
			<div class="mui-content-padded" data-bind="visible: IsTeacher">
				<button class="mui-btn mui-btn-primary mui-btn-outlined" style="width: 46%; padding: 8px 0;" data-bind="event:{tap: gotoCoursesList}">
					我的课程
				</button>
				<button type="button" class="mui-btn mui-btn-primary mui-btn-outlined" style="width: 46%;  padding: 8px 0; float: right;" data-bind="event:{tap: gotoAddCourses}">
					我要开课
				</button>
			</div>
		</div>

		<div id="middlePopover" class="mui-popover screenCenter">
			<div class="myCourse-popover">所属课程</div>
			<div class="myCourse-next">
				<!--ko text: ViewLesson().CourseName-->
				<!--/ko-->
				<i class="iconfont">&#xe618;</i>
			</div>
			<div class="myCourse-next myCourse-way myCourse">
				<button data-bind='text: ViewLesson().LocationName'></button>
				<i data-bind='text: "￥" + ViewLesson().Amount'></i>
			</div>
			<div class="myCourse-popover">上课时间</div>
			<div class="myCourse-next myCourse-way" data-bind='text: common.formatTime(ViewLesson().BeginTime, ViewLesson().EndTime)'></div>
			<div class="myCourse-popover">授课老师</div>
			<div class="myCourse-next myCourse-way" data-bind='click: gotoTeacherInfo'>
				<!--ko text: ViewLesson().TeacherName-->
				<!--/ko-->
				<i class="iconfont">&#xe618;</i>
			</div>

			<div class="myCourse-popover" data-bind='visible: InfoVisible() || Adjusting()'>调整信息</div>
			<div class="myCourse-next myCourse-m" data-bind='visible: InfoVisible() && !Adjusting()'>
				<!--ko text: common.formatTime(ViewLesson().BeginTimeNew)-->
				<!--/ko-->
			</div>
			<div class="myCourse-next myCourse-m" data-bind='visible: Adjusting, click: SelectNewTime'>
				<!--ko text: common.formatTime(BeginTimeNew())-->
				<!--/ko-->
				<i class="iconfont">&#xe618;</i>
			</div>
			<div class="myCourse-next myCourse-m" data-bind='visible: InfoVisible() && !Adjusting()'>
				<span data-bind='text: ViewLesson().Handled ? "[已拒绝]" : ViewLesson().HandlerID == UserID ? "[请确认调整时间后同意或拒绝]" : "[待对方确认]"'></span>
				<!--ko text: ViewLesson().Answer-->
				<!--/ko-->
			</div>

			<div class="myCourse-btn">
				<button data-bind='click: Agree, visible: HandleButtonsVisible'>同意</button>
				<button data-bind='click: Reject, visible: HandleButtonsVisible'>拒绝</button>
				<button data-bind='visible: (RequestButtonVisible() && !Adjusting()), click: AdjustTimeStart'>
					<i class="iconfont">&#xe63e;</i>时间调整
				</button>
				<button class="myCourse-btn-cancel myCourse-btn-colse" onclick="mui('#middlePopover').popover('toggle');" data-bind='visible: !Adjusting()'>关闭</button>
				<button class="myCourse-btn-sure" data-bind='visible: Adjusting, click: function(){ self.Adjusting(false); }'>取消</button>
				<button class="myCourse-btn-cancel" data-bind='visible: Adjusting, click: AdjustTimeFinish'>确定</button>
			</div>
		</div>

		<script src="../../script/mui/mui.js"></script>
		<script src="../../script/mui/mui.picker.min.js"></script>
		<script src="../../script/common/common.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../script/common/base.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../script/libs/knockout/knockout-3.3.0.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../script/course/myCourse.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../script/common/dtPicker.js" type="text/javascript" charset="utf-8"></script>
		<script>
			mui.init({
				swipeBack: false //禁用右滑关闭功能
			});
			mui('.mui-scroll-wrapper').scroll();
			window.addEventListener("swipeleft", function() {
				self.WeekIndex(self.WeekIndex() + 1);
				self.GetData();
			});
			window.addEventListener("swiperight", function() {
				self.WeekIndex(self.WeekIndex() - 1);
				self.GetData();
			});
			mui('body').on('shown', '.mui-popover', function(e) {
				//console.log('shown', e.detail.id);//detail为当前popover元素
			});
			mui('body').on('hidden', '.mui-popover', function(e) {
				//console.log('hidden', e.detail.id);//detail为当前popover元素
			});
		</script>
	</body>

</html>